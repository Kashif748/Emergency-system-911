<div class="container mat-elevation-z8 p-0" style="overflow: hidden">
  <mat-toolbar class="bg-white px-3 border-bottom">
    <h2>{{ "PHONEBOOK.HEADER" | translate }}</h2>

    <div class="spacer"></div>
    <button
      *appPrivileges="'PRIV_ADD_PHONEBOOK_ENTRY'"
      class="btn btn-md btn-primary font-weight-bolder py-2 px-5 cursor-pointer"
      (click)="addItem(null)"
    >
      {{ "PHONEBOOK.NEW_ITEM" | translate }}
      <span
        [inlineSVG]="'/assets/media/svg/icons/Code/Plus.svg'"
        cacheSVG="true"
        class="svg-icon svg-icon-md"
      ></span>
    </button>
  </mat-toolbar>

  <div class="p-4">
    <p-fieldset
      [toggleable]="true"
      styleClass="px-3 py-2 search-section"
      legend="{{ 'ACTIONS.ADVANCED_SEARCH' | translate }}"
      [collapsed]="true"
    >
      <form [formGroup]="searchForm" class="p-fluid p-grid">
        <div class="p-field p-col-4 p-md-3">
          <input
            type="text"
            pInputText
            formControlName="name"
            placeholder="{{ 'PHONEBOOK.FIRST_NAME' | translate }}"
          />
        </div>
        <div class="p-field p-col-4 p-md-3">
          <input
            type="text"
            pInputText
            formControlName="orgName"
            placeholder="{{ 'PHONEBOOK.ORG_NAME' | translate }}"
          />
        </div>
        <div class="p-field p-col-4 p-md-3">
          <ngx-intl-tel-input
            cssClass="p-inputtext p-component p-text-left"
            [onlyCountries]="['ae']"
            formControlName="mobileNumber"
            [enablePlaceholder]="true"
            [enableAutoCountrySelect]="true"
            searchCountryPlaceholder="{{
              'PHONEBOOK.MOBILE_NUMBER' | translate
            }}"
          >
          </ngx-intl-tel-input>
        </div>

        <div class="p-col p-d-flex">
          <div class="ml-dir-auto"></div>
          <div class="mx-1">
            <button
              pButton
              type="button"
              label="{{ 'ACTIONS.CLEAR' | translate }}"
              icon="pi pi-times"
              class="p-button-outlined"
              [loading]="loading$ | async"
              (click)="resetSearchForm()"
            ></button>
          </div>
          <div class="mx-1">
            <button
              pButton
              label="{{ 'ACTIONS.SEARCH' | translate }}"
              icon="pi pi-search"
              [loading]="loading$ | async"
              (click)="onSubmit()"
            ></button>
          </div>
        </div>
      </form>
    </p-fieldset>
    <div class="mt-4">
      <mat-progress-bar *ngIf="loading" mode="query"></mat-progress-bar>

      <table
        mat-table
        [dataSource]="phonebook$ | async"
        class="table table-head-custom table-head-bg table-borderless table-vertical-center shadow-none m-0"
      >
        <ng-container matColumnDef="id">
          <th mat-header-cell *matHeaderCellDef>
            {{ "PHONEBOOK.ID" | translate }}
          </th>
          <td mat-cell *matCellDef="let element">{{ element.id }}</td>
        </ng-container>

        <ng-container matColumnDef="title">
          <th mat-header-cell *matHeaderCellDef>
            {{ "PHONEBOOK.TITLE" | translate }}
          </th>
          <td mat-cell *matCellDef="let element">{{ element.title }}</td>
        </ng-container>

        <ng-container matColumnDef="firstName">
          <th mat-header-cell *matHeaderCellDef>
            {{ "PHONEBOOK.FIRST_NAME" | translate }}
          </th>
          <td mat-cell *matCellDef="let element">
            {{ element.firstName }} {{ element.lastName }}
          </td>
        </ng-container>

        <ng-container matColumnDef="jobTitle">
          <th mat-header-cell *matHeaderCellDef>
            {{ "PHONEBOOK.JOB_TITLE" | translate }}
          </th>
          <td mat-cell *matCellDef="let element">{{ element.jobTitle }}</td>
        </ng-container>

        <ng-container matColumnDef="phoneNumber">
          <th mat-header-cell *matHeaderCellDef>
            {{ "PHONEBOOK.PHONE_NUMBER" | translate }}
          </th>
          <td mat-cell *matCellDef="let element">{{ element.phoneNumber }}</td>
        </ng-container>
        <ng-container matColumnDef="mobileNumber">
          <th mat-header-cell *matHeaderCellDef>
            {{ "PHONEBOOK.MOBILE_NUMBER" | translate }}
          </th>
          <td mat-cell *matCellDef="let element">{{ element.mobileNumber }}</td>
        </ng-container>
        <ng-container matColumnDef="orgName">
          <th mat-header-cell *matHeaderCellDef>
            {{ "PHONEBOOK.ORG_NAME" | translate }}
          </th>
          <td mat-cell *matCellDef="let element">{{ element.orgName }}</td>
        </ng-container>
        <ng-container matColumnDef="isActive">
          <th mat-header-cell *matHeaderCellDef>
            {{ "PHONEBOOK.IS_ACTIVE" | translate }}
          </th>
          <td mat-cell *matCellDef="let element">
            <span
              *ngIf="element?.isActive"
              class="label label-rounded label-pill label-inline label-light-success mr-2"
              >{{ "ACTIONS.ACTIVE" | translate }}</span
            >
            <span
              *ngIf="!element?.isActive"
              class="label label-rounded label-light-warning label-pill label-inline mr-2"
              >{{ "ACTIONS.INACTIVE" | translate }}</span
            >
          </td>
        </ng-container>

        <!-- actions -->
        <ng-container matColumnDef="actions">
          <div class="spacer"></div>
          <th mat-header-cell *matHeaderCellDef></th>

          <td mat-cell *matCellDef="let element">
            <button
              *appPrivileges="'PRIV_ADD_PHONEBOOK_ENTRY'"
              (click)="addItem(element)"
              class="btn btn-sm btn-clean btn-icon mr-1"
            >
              <span
                [inlineSVG]="'/assets/media/svg/icons/Communication/Write.svg'"
                cacheSVG="true"
                class="svg-icon svg-icon-md svg-icon-primary"
              ></span>
            </button>
            <button
              *appPrivileges="'PRIV_DEL_PHONEBOOK_ENTRY'"
              (click)="deleteItem(element)"
              class="btn btn-sm btn-clean btn-icon mr-1"
            >
              <span
                [inlineSVG]="'./assets/media/svg/icons/General/Trash.svg'"
                cacheSVG="true"
                class="svg-icon svg-icon-md svg-icon-danger"
              ></span>
            </button>
          </td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>

        <!-- Row shown when there is no matching data. -->
        <tr class="mat-row" *matNoDataRow>
          <td class="mat-cell" colspan="8">
            <nodata-table [input]="'input'"></nodata-table>
          </td>
        </tr>
      </table>
      <mat-paginator
        *ngIf="paginator$ | async as paginator"
        [length]="paginator?.length"
        [pageSize]="20"
        (page)="pageChange($event)"
      >
      </mat-paginator>
    </div>
  </div>
</div>
